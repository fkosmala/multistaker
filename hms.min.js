$(function(){function t(){$("#btns").length<1&&$("#results").append('<div id="btns"></div>'),$("#btns").append('<input type="reset" value="Back" class="back">'),$(".back").on("click tap",function(t){t.preventDefault(),json_payload=[],stake_list=[],pending=[],$("#results").fadeOut("slow",function(){$("#tokens").empty(),$("#btns").empty(),$("#stake").prop("disabled",!1),$("#unstake").prop("disabled",!1),$("#claim").prop("disabled",!1),$("#accountForm").fadeIn("slow")})})}$("#stake").on("click tap",function(e){$("#stake").prop("disabled",!0);const o="https://api2.hive-engine.com/rpc/contracts";let n=$("#hiveAccount").val().toLowerCase();if(n.length<3)$("#error").text("Minimum 3 letters");else{var a=$("#hiveAccount").val().toLowerCase();stake_list=[],all_list=[],Promise.resolve(function(t){return new Promise((e,n)=>{const a={id:1,jsonrpc:"2.0",method:"find",params:{contract:"tokens",table:"balances",query:{account:t}}};axios.post(o,a).then(t=>e(t.data.result)).catch(t=>(console.log(t),n(t)))})}(a)).then(e=>{e.forEach(t=>{all_list.push(t),parseFloat(t.balance)>0&&parseFloat(t.stake)>0&&stake_list.push({symbol:t.symbol,balance:t.balance})}),stake_list.length<=0?$("#error").text("Don't find any tokens to stake :("):($("#title").text("Tokens to stake"),stake_list.sort((t,e)=>t.symbol>e.symbol?1:-1),stake_list.forEach(t=>{$("#tokens").append('<input class="token" type="checkbox" data-balance="'+t.balance+'" id="'+t.symbol+'" name="'+t.symbol+'" /><label for="'+t.symbol+'">'+t.balance+" "+t.symbol+"</label><br />")}),$("#btns").append('<button id="stakeNow">Stake Them now !</button>'),t(),$("#accountForm").fadeOut("slow",function(){$("#results").fadeIn("slow")}),$("#checkAll").on("click tap",function(){$("input:checkbox").not(this).prop("checked",this.checked)}),$("#stakeNow").on("click tap",function(){json_payload=[],$(".token:checkbox:checked").each(function(){json_payload.push({contractName:"tokens",contractAction:"stake",contractPayload:{symbol:$(this).attr("id"),to:a,quantity:String($(this).data("balance"))}})}),json_payload=JSON.stringify(json_payload),"object"==typeof hive_keychain?hive_keychain.requestCustomJson(n,"ssc-mainnet-hive","Active",json_payload,"HMS Stake Your Tokens",function(e){e.success?($("#results").html("<h2>Your selected tokens are now staked !</h2>"),t()):$("#results").fadeOut("slow",function(){$("#accountForm").fadeIn("slow",function(){$("#error").text(e.message),$("#stake").prop("disabled",!1),$("#tokens").empty(),$("#btns").empty()})})}):(network="ssc-mainnet-hive",signerUrl='https://hivesigner.com/sign/custom-json?required_auths=["'+n+'"]&id='+network+"&authority=active&required_posting_auths=[]&json="+json_payload,window.location.href=signerUrl)}))}),e.preventDefault()}}),$("#unstake").on("click tap",function(e){$("#unstake").prop("disabled",!0);const o="https://api2.hive-engine.com/rpc/contracts";let n=$("#hiveAccount").val().toLowerCase();if(n.length<3)$("#error").text("Minimum 3 letters");else{var a=$("#hiveAccount").val().toLowerCase();unstake_list=[],Promise.resolve(function(t){return new Promise((e,n)=>{const a={id:1,jsonrpc:"2.0",method:"find",params:{contract:"tokens",table:"balances",query:{account:t}}};axios.post(o,a).then(t=>e(t.data.result)).catch(t=>(console.log(t),n(t)))})}(a)).then(e=>{e.forEach(t=>{parseFloat(t.stake)>0&&unstake_list.push({symbol:t.symbol,stake:t.stake})}),unstake_list.length<=0?$("#error").text("Don't find any tokens to unstake :("):($("#title").text("Tokens to unstake"),unstake_list.sort((t,e)=>t.symbol>e.symbol?1:-1),unstake_list.forEach(t=>{$("#tokens").append('<input class="token numbers" type="number" min="0.001" max="'+t.stake+'" data-stake="'+t.stake+'" id="'+t.symbol+'" name="'+t.symbol+'" />'+t.stake+" "+t.symbol+"<br />")}),$("#btns").append('<button id="unstakeNow">Unstake Them now !</button>'),t(),$("#accountForm").fadeOut("slow",function(){$("#results").fadeIn("slow")}),$("#checkAll").on("click tap",function(){$(".numbers").each(function(){$(this).val($(this).attr("max"))})}),$("#unstakeNow").on("click tap",function(){json_payload=[],$(".numbers").each(function(){""!=$(this).val()&&json_payload.push({contractName:"tokens",contractAction:"unstake",contractPayload:{symbol:$(this).attr("id"),quantity:String($(this).val())}})}),json_payload=JSON.stringify(json_payload),"object"==typeof hive_keychain?hive_keychain.requestCustomJson(n,"ssc-mainnet-hive","Active",json_payload,"HMS Unstake Your Tokens",function(e){e.success?($("#results").html("<h2>Your selected tokens are unstaked !</h2>"),t()):$("#results").fadeOut("slow",function(){$("#accountForm").fadeIn("slow",function(){$("#error").text(e.message),$("#unstake").prop("disabled",!1),$("#tokens").empty(),$("#btns").empty()})})}):(network="ssc-mainnet-hive",signerUrl='https://hivesigner.com/sign/custom-json?required_auths=["'+n+'"]&id='+network+"&authority=active&required_posting_auths=[]&json="+json_payload,window.location.href=signerUrl)}))}),e.preventDefault()}}),$("#claim").on("click tap",function(e){$("#claim").prop("disabled",!0),e.preventDefault();let o=$("#hiveAccount").val().toLowerCase();const n="https://scot-api.hive-engine.com/@"+o+"?hive=1",a=[];$.getJSON(n,function(e){for(const t in e)e[t].pending_token>0&&(balance=e[t].pending_token/1e8,a.push({symbol:t,balance:balance}));a.length<=0?$("#error").text("Don't find any rewards to claim :("):($("#title").text("Rewards to claim"),$,a.sort((t,e)=>t.symbol>e.symbol?1:-1),a.forEach(t=>{$("#tokens").append('<input class="token" type="checkbox" data-balance="'+t.balance+'" id="'+t.symbol+'" name="'+t.symbol+'" /><label for="'+t.symbol+'">'+t.balance+" "+t.symbol+"</label><br />")}),$("#btns").append('<button id="claimNow">Claim your selected rewards now !</button>'),$("#btns").append('<p>You can now Auto-claim (each a day) all Hive rewards & HiveEngine tokens !<p> <button id="autoclaim" href="#">Authorize hive.autoclaim</button>'),t(),$("#autoclaim").on("click tap",function(e){$("#claim").prop("disabled",!0),e.preventDefault();let o=$("#hiveAccount").val().toLowerCase();"object"==typeof hive_keychain?hive_keychain.requestAddAccountAuthority(o,"hive.autoclaim","posting","1",function(e){$("#results").html("<h2>All your tokens are now autoclaimed !</h2>"),t()}):(n="https://hivesigner.com/authorize/hive.autoclaim",window.location.href=n)}),$("#accountForm").fadeOut("slow",function(){$("#results").fadeIn("slow")}),$("#checkAll").on("click tap",function(){$("input:checkbox").not(this).prop("checked",this.checked)}),$("#claimNow").on("click tap",function(){json_payload=[],$(".token:checkbox:checked").each(function(){json_payload.push({symbol:$(this).attr("id")})}),json_payload=JSON.stringify(json_payload),"object"==typeof hive_keychain?hive_keychain.requestCustomJson(o,"scot_claim_token","Active",json_payload,"HMS Claim Your Rewards",function(e){e.success?($("#results").html("<h2>All your HiveEngine rewards are claimed !</h2>"),t()):$("#results").fadeOut("slow",function(){$("#accountForm").fadeIn("slow",function(){$("#error").text(e.message),$("#claim").prop("disabled",!1),$("#tokens").empty(),$("#btns").empty()})})}):(network="scot_claim_token",signerUrl='https://hivesigner.com/sign/custom-json?required_auths=["'+o+'"]&id='+network+"&authority=active&required_posting_auths=[]&json="+json_payload,window.location.href=signerUrl)}))})})});
